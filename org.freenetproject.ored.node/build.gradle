plugins {
    id 'org.beryx.jlink' version '2.25.0'
    id 'ored.java-conventions'
}

dependencies {
    implementation project(':org.freenetproject.ored.support')
    implementation project(':org.freenetproject.ored.crypt')
    implementation project(':org.freenetproject.ored.l10n')
    implementation project(':org.freenetproject.ored.client')
    implementation project(':org.freenetproject.ored.config')
    implementation project(':org.freenetproject.ored.store')

    implementation 'net.java.dev.jna:jna-jpms:5.11.0'
    implementation 'net.java.dev.jna:jna-platform-jpms:5.11.0'
    implementation "org.freenetproject:freenet-ext:29"

    testImplementation testFixtures(project(":org.freenetproject.ored.support"))
}

jlink {
    options = [
            '--ignore-signing-information',
            '--compress', '2',
            '--no-header-files',
            '--no-man-pages',
            '--strip-debug'
    ]

    mainClass = "freenet.node.NodeStarter"

    imageDir = file("$rootDir/build/image")
    imageZip = file("$rootDir/build/image.zip")

    launcher {
        name = 'ored'
        jvmArgs = [
                '-Dnetworkaddress.cache.ttl', '0',
                '-Dnetworkaddress.cache.negative.ttl', '0',
                '-Xss512k',
        ]
        args = []
    }
}